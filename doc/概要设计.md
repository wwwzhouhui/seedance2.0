# Seedance 2.0 概要设计

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | Seedance 2.0 AI 视频生成 |
| 文档版本 | v1.0.0 |
| 创建日期 | 2026-02-13 |
| 文档状态 | 正式发布 |

## 2. 系统概述

### 2.1 系统定位

Seedance 2.0 是一款 AI 视频生成 Web 应用，前端采用 React + TypeScript 构建，后端使用 Express 提供 API 服务，通过对接即梦平台 API 实现 AI 视频生成能力。

### 2.2 系统目标

- 提供简洁易用的用户界面
- 支持多图参考的视频生成
- 实现稳定的异步任务处理
- 提供可靠的视频预览与下载功能

## 3. 系统架构

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户浏览器                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  React App  │  │   State     │  │  Services   │             │
│  │  (前端UI)   │  │  (状态管理)  │  │  (API调用)  │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└────────────────────────────┬────────────────────────────────────┘
                             │ HTTP/WebSocket
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Express Server (后端)                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  API Routes │  │ Task Manager│  │  Jimeng API │             │
│  │  (路由层)   │  │ (任务管理)  │  │  (API对接)  │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└────────────────────────────┬────────────────────────────────────┘
                             │ HTTPS
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                      即梦平台 API                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  ImageX CDN │  │  Seedance   │  │  Video CDN  │             │
│  │  (图片上传) │  │  (视频生成) │  │  (视频存储) │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 技术架构

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 前端框架 | React 19 + TypeScript | 响应式UI组件 |
| 构建工具 | Vite 6 | 快速开发构建 |
| 样式方案 | Tailwind CSS 3 | 原子化CSS |
| 后端服务 | Express 4 + Multer | RESTful API |
| AI模型 | Seedance 2.0 | 即梦平台视频生成模型 |

## 4. 模块设计

### 4.1 前端模块划分

```
src/
├── App.tsx              # 根组件，状态管理
├── main.tsx             # 应用入口
├── types.ts             # 类型定义与常量
├── index.css            # 全局样式
├── components/          # 组件目录
│   ├── VideoPlayer.tsx  # 视频播放器
│   ├── SettingsModal.tsx # 设置弹窗
│   ├── PromptInput.tsx  # 提示词输入（预留）
│   ├── UploadArea.tsx   # 上传区域（预留）
│   ├── RatioSelector.tsx # 比例选择（预留）
│   ├── DurationSelector.tsx # 时长选择（预留）
│   ├── Toolbar.tsx      # 工具栏（预留）
│   └── Icons.tsx        # 图标组件
└── services/
    └── videoService.ts  # 视频生成服务
```

### 4.2 后端模块划分

```
server/
├── index.js             # 服务入口，路由定义
└── package.json         # 依赖配置
```

**核心模块：**

| 模块 | 职责 |
|------|------|
| API Routes | 处理HTTP请求，参数验证 |
| Task Manager | 任务创建、状态管理、过期清理 |
| Jimeng API | 即梦API封装，认证签名 |
| Image Upload | 图片上传到ImageX CDN |
| Video Proxy | 视频流代理，解决CORS |

## 5. 核心流程设计

### 5.1 视频生成主流程

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  用户    │     │  前端    │     │  后端    │     │  即梦API │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │ 上传图片+提示词  │                │                │
     │───────────────>│                │                │
     │                │ POST /api/     │                │
     │                │ generate-video │                │
     │                │───────────────>│                │
     │                │                │ 上传图片到ImageX│
     │                │                │───────────────>│
     │                │                │                │
     │                │                │ 提交生成任务   │
     │                │                │───────────────>│
     │                │                │                │
     │                │   { taskId }   │                │
     │                │<───────────────│                │
     │                │                │                │
     │  显示进度      │                │                │
     │<───────────────│                │                │
     │                │                │                │
     │                │ 轮询 /api/task │                │
     │                │───────────────>│                │
     │                │                │ 查询生成状态   │
     │                │                │───────────────>│
     │                │                │                │
     │                │  { status }    │                │
     │                │<───────────────│                │
     │                │                │                │
     │  ...循环轮询... │                │                │
     │                │                │                │
     │                │  { done, url } │                │
     │                │<───────────────│                │
     │                │                │                │
     │  播放视频      │                │                │
     │<───────────────│                │                │
     │                │                │                │
```

### 5.2 图片上传流程

```
后端收到图片 → 获取上传令牌 → 申请上传权限 → 上传图片文件 → 提交上传 → 返回图片URI
```

**详细步骤：**

1. 调用 `/mweb/v1/get_upload_token` 获取上传凭证
2. 使用 AWS4-HMAC-SHA256 签名请求 ImageX API
3. 上传图片二进制数据到指定 URL
4. 提交上传确认，获取图片 URI

### 5.3 任务状态流转

```
                    ┌─────────────┐
                    │  创建任务   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
          ┌────────│ processing  │────────┐
          │        └─────────────┘        │
          │                                 │
          ▼                                 ▼
   ┌─────────────┐                   ┌─────────────┐
   │    done     │                   │    error    │
   └─────────────┘                   └─────────────┘
   (返回视频URL)                      (返回错误信息)
```

## 6. 接口设计

### 6.1 前端-后端接口

#### POST /api/generate-video

**功能：** 提交视频生成任务

**请求格式：** multipart/form-data

**响应格式：** application/json

```json
{
  "taskId": "task_1_1739404800000"
}
```

#### GET /api/task/:taskId

**功能：** 查询任务状态

**响应格式：** application/json

```json
{
  "status": "processing" | "done" | "error",
  "elapsed": 60,
  "progress": "进度描述",
  "result": { ... },
  "error": "错误信息"
}
```

#### GET /api/video-proxy?url=xxx

**功能：** 代理视频流，解决 CORS 问题

**响应：** video/mp4 流式数据

### 6.2 后端-即梦API接口

| 接口 | 方法 | 功能 |
|------|------|------|
| /mweb/v1/get_upload_token | POST | 获取图片上传凭证 |
| /mweb/v1/aigc_draft/generate | POST | 提交视频生成任务 |
| /mweb/v1/get_history_by_ids | POST | 查询生成历史状态 |
| /mweb/v1/get_local_item_list | POST | 获取高清视频URL |

## 7. 数据流设计

### 7.1 前端状态流

```
用户操作 → 事件处理函数 → setState → 组件重新渲染
```

**核心状态：**
- `images`: 上传的图片列表
- `prompt`: 提示词
- `ratio`: 画面比例
- `duration`: 视频时长
- `referenceMode`: 参考模式
- `generation`: 生成状态
- `sessionId`: 会话ID

### 7.2 后端数据流

```
请求 → 参数验证 → 任务创建 → 异步处理 → 状态更新 → 返回结果
```

## 8. 安全设计

### 8.1 认证机制

- 使用即梦平台 SessionID 进行用户认证
- SessionID 通过请求头 Cookie 传递
- 支持环境变量预设和界面动态配置

### 8.2 数据安全

- SessionID 输入框默认密码隐藏
- 敏感信息不记录到日志
- 视频代理服务隐藏原始 CDN URL

### 8.3 请求安全

- AWS4-HMAC-SHA256 签名验证
- 请求头伪造防护
- 请求重试机制

## 9. 性能设计

### 9.1 前端优化

- 使用 React.memo 减少不必要的重渲染
- 图片预览使用 blob URL，避免重复上传
- 组件按需加载

### 9.2 后端优化

- 异步任务处理，不阻塞主线程
- 内存任务存储，快速查询
- 定期清理过期任务

### 9.3 网络优化

- 视频流式代理，避免内存占用
- 支持视频缓存 (Cache-Control)
- 请求超时控制

## 10. 部署设计

### 10.1 开发环境

```
前端: Vite Dev Server (http://localhost:5173)
后端: Express Server (http://localhost:3001)
代理: Vite proxy /api → localhost:3001
```

### 10.2 生产环境

```
构建: npm run build (生成 dist 目录)
部署: Express 同时提供静态文件和 API
端口: 默认 3001
```

## 11. 扩展性设计

### 11.1 前端扩展点

- 组件预留了多个独立文件 (PromptInput, UploadArea 等)
- 类型定义集中管理，便于扩展
- 服务层抽象，支持多后端切换

### 11.2 后端扩展点

- 任务存储可替换为 Redis/数据库
- API 路由支持中间件扩展
- 日志系统可集成第三方服务

## 12. 监控与日志

### 12.1 日志设计

| 级别 | 场景 |
|------|------|
| INFO | 任务创建、状态变更、请求成功 |
| WARN | 重试、超时 |
| ERROR | 任务失败、API异常 |

### 12.2 关键监控指标

- 任务成功率
- 平均生成时长
- 错误类型分布
- API 响应时间
