# Seedance 2.0 数据字典

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | Seedance 2.0 AI 视频生成 |
| 文档版本 | v1.0.0 |
| 创建日期 | 2026-02-13 |
| 文档状态 | 正式发布 |

## 2. 前端数据结构

### 2.1 类型定义 (src/types.ts)

#### 2.1.1 AspectRatio - 画面比例

| 字段名 | 类型 | 可选值 | 说明 |
|--------|------|--------|------|
| AspectRatio | string | '21:9' \| '16:9' \| '4:3' \| '1:1' \| '3:4' \| '9:16' | 视频画面比例 |

#### 2.1.2 Duration - 视频时长

| 字段名 | 类型 | 可选值 | 说明 |
|--------|------|--------|------|
| Duration | number | 4 \| 5 \| 6 \| 7 \| 8 \| 9 \| 10 \| 11 \| 12 \| 13 \| 14 \| 15 | 视频时长（秒） |

#### 2.1.3 ModelId - 模型标识

| 字段名 | 类型 | 可选值 | 说明 |
|--------|------|--------|------|
| ModelId | string | 'jimeng-video-seedance-2.0' \| 'seedance-2.0' | AI模型标识 |

#### 2.1.4 ReferenceMode - 参考模式

| 字段名 | 类型 | 可选值 | 说明 |
|--------|------|--------|------|
| ReferenceMode | string | '全能参考' \| '首帧参考' \| '尾帧参考' | 图片参考模式 |

#### 2.1.5 UploadedImage - 上传图片

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 图片唯一标识，格式：img-{自增ID} |
| file | File | 是 | 原始文件对象 |
| previewUrl | string | 是 | 本地预览URL (blob URL) |
| index | number | 是 | 引用索引 (1-5)，用于 @1, @2 语法 |

**示例：**
```typescript
{
  id: "img-1",
  file: File { name: "image.png", size: 102400, type: "image/png" },
  previewUrl: "blob:http://localhost:5173/abc-123",
  index: 1
}
```

#### 2.1.6 GenerateVideoRequest - 视频生成请求

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| prompt | string | 是 | 提示词，支持@引用语法 |
| model | ModelId | 是 | 模型标识 |
| ratio | AspectRatio | 是 | 画面比例 |
| duration | Duration | 是 | 视频时长 |
| files | File[] | 是 | 参考图片数组 |
| sessionId | string | 否 | 即梦SessionID |

#### 2.1.7 VideoGenerationResponse - 视频生成响应

| 字段名 | 类型 | 说明 |
|--------|------|------|
| created | number | 创建时间戳（秒） |
| data | VideoData[] | 视频数据数组 |

**VideoData 结构：**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| url | string | 视频下载URL |
| revised_prompt | string | AI优化后的提示词 |

**示例：**
```typescript
{
  created: 1739404800,
  data: [
    {
      url: "https://v1-dreamnia.jimeng.com/xxx.mp4",
      revised_prompt: "一个女孩在公园里奔跑..."
    }
  ]
}
```

#### 2.1.8 GenerationStatus - 生成状态

| 状态值 | 说明 |
|--------|------|
| idle | 空闲，未开始生成 |
| generating | 生成中 |
| success | 生成成功 |
| error | 生成失败 |

#### 2.1.9 GenerationState - 生成状态对象

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| status | GenerationStatus | 是 | 当前状态 |
| progress | string | 否 | 进度描述文案 |
| result | VideoGenerationResponse | 否 | 生成结果（成功时） |
| error | string | 否 | 错误信息（失败时） |

#### 2.1.10 RatioOption - 比例选项

| 字段名 | 类型 | 说明 |
|--------|------|------|
| value | AspectRatio | 比例值 |
| label | string | 显示标签 |
| widthRatio | number | 宽度比例值 |
| heightRatio | number | 高度比例值 |

**示例：**
```typescript
{
  value: "16:9",
  label: "16:9",
  widthRatio: 16,
  heightRatio: 9
}
```

### 2.2 常量定义

#### 2.2.1 RATIO_OPTIONS - 画面比例选项

| value | label | widthRatio | heightRatio | 分辨率 |
|-------|-------|------------|-------------|--------|
| 21:9 | 21:9 | 21 | 9 | 1680×720 |
| 16:9 | 16:9 | 16 | 9 | 1280×720 |
| 4:3 | 4:3 | 4 | 3 | 960×720 |
| 1:1 | 1:1 | 1 | 1 | 720×720 |
| 3:4 | 3:4 | 3 | 4 | 720×960 |
| 9:16 | 9:16 | 9 | 16 | 720×1280 |

#### 2.2.2 DURATION_OPTIONS - 时长选项

```typescript
[4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
```

#### 2.2.3 REFERENCE_MODES - 参考模式选项

```typescript
['全能参考', '首帧参考', '尾帧参考']
```

## 3. 后端数据结构

### 3.1 任务管理

#### 3.1.1 Task - 任务对象

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | string | 任务ID，格式：task_{计数器}_{时间戳} |
| status | string | 状态：processing \| done \| error |
| progress | string | 进度描述 |
| startTime | number | 开始时间戳（毫秒） |
| result | object | 生成结果 |
| error | string | 错误信息 |

**示例：**
```javascript
{
  id: "task_1_1739404800000",
  status: "processing",
  progress: "正在上传参考图片...",
  startTime: 1739404800000,
  result: null,
  error: null
}
```

### 3.2 API 请求/响应结构

#### 3.2.1 POST /api/generate-video 请求

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| prompt | string | 是 | 提示词 |
| ratio | string | 是 | 画面比例 |
| duration | string | 是 | 视频时长 |
| sessionId | string | 否 | 即梦SessionID |
| files | File[] | 是 | 参考图片（multipart/form-data） |

**响应：**
```json
{
  "taskId": "task_1_1739404800000"
}
```

#### 3.2.2 GET /api/task/:taskId 响应

**处理中：**
```json
{
  "status": "processing",
  "elapsed": 60,
  "progress": "AI正在生成视频，请耐心等待..."
}
```

**成功：**
```json
{
  "status": "done",
  "elapsed": 180,
  "result": {
    "created": 1739404800,
    "data": [
      {
        "url": "https://v1-dreamnia.jimeng.com/xxx.mp4",
        "revised_prompt": "..."
      }
    ]
  }
}
```

**失败：**
```json
{
  "status": "error",
  "elapsed": 30,
  "error": "内容被过滤，请修改提示词后重试"
}
```

### 3.3 即梦API 数据结构

#### 3.3.1 视频分辨率映射 (VIDEO_RESOLUTION)

| ratio | width | height |
|-------|-------|--------|
| 1:1 | 720 | 720 |
| 4:3 | 960 | 720 |
| 3:4 | 720 | 960 |
| 16:9 | 1280 | 720 |
| 9:16 | 720 | 1280 |
| 21:9 | 1680 | 720 |

#### 3.3.2 Material - 素材对象

| 字段名 | 类型 | 说明 |
|--------|------|------|
| type | string | 固定值 '' |
| id | string | UUID |
| material_type | string | 固定值 'image' |
| image_info | ImageInfo | 图片信息 |

#### 3.3.3 ImageInfo - 图片信息

| 字段名 | 类型 | 说明 |
|--------|------|------|
| type | string | 固定值 'image' |
| id | string | UUID |
| source_from | string | 固定值 'upload' |
| platform_type | number | 固定值 1 |
| name | string | 文件名 |
| image_uri | string | 图片URI |
| width | number | 宽度 |
| height | number | 高度 |
| format | string | 格式 |
| uri | string | URI |

#### 3.3.4 MetaItem - 元数据项

| 字段名 | 类型 | 说明 |
|--------|------|------|
| meta_type | string | 'text' \| 'image' |
| text | string | 文本内容 |
| material_ref | object | 图片引用（当meta_type='image'时） |

**文本类型示例：**
```json
{
  "meta_type": "text",
  "text": "一个女孩在公园里奔跑"
}
```

**图片类型示例：**
```json
{
  "meta_type": "image",
  "text": "",
  "material_ref": {
    "material_idx": 0
  }
}
```

## 4. 本地存储

### 4.1 localStorage 键值

| 键名 | 类型 | 说明 |
|------|------|------|
| seedance_session_id | string | 即梦SessionID |

## 5. 环境变量

### 5.1 前端环境变量

| 变量名 | 类型 | 说明 |
|--------|------|------|
| VITE_DEFAULT_SESSION_ID | string | 默认SessionID（可选） |

### 5.2 后端环境变量

| 变量名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| PORT | number | 3001 | 服务端口 |
| VITE_DEFAULT_SESSION_ID | string | '' | 默认SessionID |

## 6. 配置常量

### 6.1 系统配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| MAX_IMAGES | 5 | 最大上传图片数 |
| MAX_FILE_SIZE | 20MB | 单文件最大大小 |
| MAX_PROMPT_LENGTH | 5000 | 提示词最大长度 |
| POLL_INTERVAL | 3000ms | 前端轮询间隔 |
| MAX_POLL_TIME | 25min | 最大轮询时间 |
| TASK_EXPIRE_TIME | 30min | 任务过期时间 |

### 6.2 即梦API配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| JIMENG_BASE_URL | https://jimeng.jianying.com | 即梦API基础URL |
| DEFAULT_ASSISTANT_ID | 513695 | 助手ID |
| VERSION_CODE | 5.8.0 | 版本号 |
| PLATFORM_CODE | 7 | 平台码 |
| SEEDANCE_MODEL | dreamina_seedance_40_pro | 模型名称 |
| SEEDANCE_DRAFT_VERSION | 3.3.8 | 草稿版本 |

## 7. 错误码

### 7.1 API错误码

| 错误码 | 说明 | 用户提示 |
|--------|------|----------|
| 401 | 未授权 | 未配置 Session ID，请在设置中填写 |
| 400 | 参数错误 | Seedance 2.0 需要至少上传一张参考图片 |
| 500 | 服务器错误 | 服务器内部错误，请稍后重试 |

### 7.2 即梦API错误码

| 错误码 | 说明 | 用户提示 |
|--------|------|----------|
| 5000 | 积分不足 | 即梦积分不足，请前往即梦官网领取积分 |
| 2038 | 内容过滤 | 内容被过滤，请修改提示词后重试 |
| timeout | 生成超时 | 视频生成超时 (约20分钟)，请稍后重试 |
